<!DOCTYPE html>
<html>
<head>
    <title>Turbo Striker: Pro League</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Arial Black', sans-serif; color: white; }
        #hub, #shop-menu, #post-game {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); display: flex; flex-direction: column; 
            align-items: center; justify-content: center; z-index: 200;
        }
        .nav-btn { padding: 15px 40px; background: #ffd700; border: none; border-radius: 50px; cursor: pointer; font-size: 1.2em; margin: 10px; font-weight: 900; }
        #game-ui { position: absolute; top: 20px; width: 100%; display: none; text-align: center; pointer-events: none; }
        .progress-container { width: 300px; height: 20px; background: #333; border-radius: 10px; margin: 20px; overflow: hidden; border: 2px solid #fff; }
        .progress-fill { height: 100%; width: 0%; background: #00d4ff; transition: width 1s ease-out; }
        .shop-item { padding: 10px; border: 1px solid #fff; margin: 5px; cursor: pointer; width: 200px; text-align: center; }
    </style>
</head>
<body>

    <div id="hub">
        <h1 style="font-size: 3.5em; color: #ffd700;">TURBO STRIKER</h1>
        <div id="rank-tag">RANK: BRONZE</div>
        <button class="nav-btn" onclick="startGame()">PLAY MATCH</button>
        <button class="nav-btn" style="background:#444; color:white;" onclick="openShop()">THE SHOP</button>
    </div>

    <div id="shop-menu" style="display:none;">
        <h1>PRO SHOP</h1>
        <p>Credits: <span id="credits-val">0</span></p>
        <div class="shop-item" onclick="buyColor(0xff4757)">RED CHASSIS (500)</div>
        <div class="shop-item" onclick="buyColor(0x2ed573)">GREEN CHASSIS (500)</div>
        <button class="nav-btn" onclick="closeShop()">BACK</button>
    </div>

    <div id="post-game" style="display:none;">
        <h1 id="win-loss-msg">VICTORY!</h1>
        <p>Rank Progress</p>
        <div class="progress-container"><div id="xp-bar" class="progress-fill"></div></div>
        <button class="nav-btn" onclick="location.reload()">CONTINUE</button>
    </div>

    <div id="game-ui">
        <div style="font-size: 3em;"><span id="p1-s">0</span> - <span id="cpu-s">0</span></div>
    </div>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
    </script>

    <script type="module">
        import * as THREE from 'three';

        // --- PERSISTENT DATA ---
        let stats = JSON.parse(localStorage.getItem('turboData')) || { wins: 0, credits: 0, color: 0x00d4ff };
        const save = () => localStorage.setItem('turboData', JSON.stringify(stats));

        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x050505);
        const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // --- STADIUM CONSTRUCTION ---
        const amb = new THREE.AmbientLight(0xffffff, 0.4); scene.add(amb);
        const spot = new THREE.PointLight(0xffffff, 2000); spot.position.set(0, 40, 0); scene.add(spot);

        // Ground
        const pitch = new THREE.Mesh(new THREE.PlaneGeometry(60, 100), new THREE.MeshStandardMaterial({ color: 0x1a4a1a }));
        pitch.rotation.x = -Math.PI/2; scene.add(pitch);

        // Walls (Collision-Ready)
        const wallMat = new THREE.MeshStandardMaterial({ color: 0x333333, metalness: 0.8 });
        const wallLeft = new THREE.Mesh(new THREE.BoxGeometry(2, 10, 100), wallMat);
        wallLeft.position.set(-31, 5, 0);
        const wallRight = new THREE.Mesh(new THREE.BoxGeometry(2, 10, 100), wallMat);
        wallRight.position.set(31, 5, 0);
        scene.add(wallLeft, wallRight);

        // --- ENTITIES ---
        const ball = new THREE.Mesh(new THREE.IcosahedronGeometry(1.5, 1), new THREE.MeshStandardMaterial({ color: 0xffffff, flatShading: true }));
        ball.position.y = 1.5; scene.add(ball);

        const p1 = new THREE.Mesh(new THREE.BoxGeometry(2.5, 1.2, 4), new THREE.MeshStandardMaterial({ color: stats.color }));
        const ai = new THREE.Mesh(new THREE.BoxGeometry(2.5, 1.2, 4), new THREE.MeshStandardMaterial({ color: 0xffffff }));
        scene.add(p1, ai);

        let ballVel = new THREE.Vector3(), keys = {}, active = false, pScore = 0, aScore = 0;

        window.startGame = () => {
            document.getElementById('hub').style.display = 'none';
            document.getElementById('game-ui').style.display = 'block';
            p1.position.set(0, 0.6, 35); ai.position.set(0, 0.6, -35);
            active = true;
        };

        window.openShop = () => { 
            document.getElementById('credits-val').innerText = stats.credits;
            document.getElementById('shop-menu').style.display = 'flex'; 
        };
        window.closeShop = () => { document.getElementById('shop-menu').style.display = 'none'; };
        window.buyColor = (c) => { if(stats.credits >= 500) { stats.credits -= 500; stats.color = c; save(); alert("Unlocked!"); } };

        function update(dt) {
            if(!active) return;

            // Player Logic
            if(keys['KeyW']) p1.translateZ(-40 * dt);
            if(keys['KeyS']) p1.translateZ(20 * dt);
            if(keys['KeyA']) p1.rotation.y += 4 * dt;
            if(keys['KeyD']) p1.rotation.y -= 4 * dt;

            // AI Logic
            const aiDir = new THREE.Vector3().subVectors(ball.position, ai.position).normalize();
            ai.position.addScaledVector(aiDir, 25 * dt);
            ai.lookAt(ball.position.x, 0.6, ball.position.z);

            // Ball Physics
            ball.position.add(ballVel.clone().multiplyScalar(dt * 60));
            ballVel.multiplyScalar(0.985);

            // STADIUM COLLISIONS (No going through walls/floor)
            [p1, ai, ball].forEach(obj => {
                if(obj.position.y < (obj === ball ? 1.5 : 0.6)) obj.position.y = (obj === ball ? 1.5 : 0.6);
                if(obj.position.x > 29) { obj.position.x = 29; if(obj === ball) ballVel.x *= -0.7; }
                if(obj.position.x < -29) { obj.position.x = -29; if(obj === ball) ballVel.x *= -0.7; }
                if(Math.abs(obj.position.z) > 49) {
                    if(obj === ball && Math.abs(obj.position.x) < 10) {
                        if(obj.position.z > 0) aScore++; else pScore++;
                        checkMatchEnd();
                        ball.position.set(0,5,0); ballVel.set(0,0,0);
                    } else {
                        obj.position.z = Math.sign(obj.position.z) * 49;
                        if(obj === ball) ballVel.z *= -0.7;
                    }
                }
            });

            if(p1.position.distanceTo(ball.position) < 3.5) ballVel.subVectors(ball.position, p1.position).normalize().multiplyScalar(1.5);
            if(ai.position.distanceTo(ball.position) < 3.5) ballVel.subVectors(ball.position, ai.position).normalize().multiplyScalar(1.3);

            document.getElementById('p1-s').innerText = pScore;
            document.getElementById('cpu-s').innerText = aScore;
            camera.position.lerp(new THREE.Vector3(p1.position.x, 25, p1.position.z + 35), 0.1);
            camera.lookAt(p1.position);
        }

        function checkMatchEnd() {
            if(pScore >= 3 || aScore >= 3) {
                active = false;
                document.getElementById('post-game').style.display = 'flex';
                const won = pScore >= 3;
                document.getElementById('win-loss-msg').innerText = won ? "VICTORY!" : "DEFEAT";
                if(won) { stats.wins++; stats.credits += 200; save(); }
                setTimeout(() => { document.getElementById('xp-bar').style.width = ((stats.wins % 5) / 5 * 100) + "%"; }, 500);
            }
        }

        window.addEventListener('keydown', e => keys[e.code] = true);
        window.addEventListener('keyup', e => keys[e.code] = false);
        let last = 0;
        function animate(t) { requestAnimationFrame(animate); update((t - last)/1000); last = t; renderer.render(scene, camera); }
        animate(0);
    </script>
</body>
</html>
